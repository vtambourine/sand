#!/usr/bin/env node
import path from 'path';
import parseArgs from 'minimist';
import Server from '../server';
import BaseRenderer from '../server/base-renderer';
import ReactRenderer from '../server/react-renderer';
// import HandlebarsRenderer from '../server/renderers/handlebars';

process.env.NODE_ENV = process.env.NODE_ENV || 'production';

const argv = parseArgs(process.argv.slice(2), {
  alias: {
    h: 'hostname',
    p: 'port'
  },
  string: [ 'h' ],
  default: {
    h: 'localhost',
    p: '3001'
  }
});

// const renderer = new BaseRenderer(process.cwd());
const componentsDir = path.join(process.cwd(), 'pages/templates');
const renderer = new ReactRenderer(componentsDir);
const server = new Server(renderer);

server.start(argv.port, argv.hostname)
  .then(() => {
    console.log(`[sand] Ready on http://${argv.hostname}:${argv.port}`);
  })
  .catch((error) => {
    console.error('???', error);
    process.exit(1);
  });
