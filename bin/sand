#!/usr/bin/env node

import parseArgs from 'minimist';
import Server from '../server';
import Renderer from '../server/renderer';
import HandlebarsRenderer from '../server/renderers/handlebars';

process.env.NODE_ENV = process.env.NODE_ENV || 'production';

const argv = parseArgs(process.argv.slice(2), {
  alias: {
    h: 'hostname',
    p: 'port'
  },
  string: [ 'h' ],
  default: {
    h: 'localhost',
    p: '3001'
  }
});

const renderer = new HandlebarsRenderer(process.cwd());
const server = new Server(renderer);

server.start(argv.port, argv.hostname)
  .then(() => {
    console.log(`[sand] Ready on http://${argv.hostname}:${argv.port}`);
  })
  .catch((error) => {
    console.error('???', error);
    process.exit(1);
  });
